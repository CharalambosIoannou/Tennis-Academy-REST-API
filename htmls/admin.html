<!DOCTYPE html>
<html lang="en">
<head>
  <username>LearnTennis</username>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <script type="text/javascript"  src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <link href="css/bootstrap.css" rel="stylesheet" />
  <link href="css/bootstrap-theme.css" rel="stylesheet" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
  <link rel="stylesheet" type="text/css" href="stylesheet.css">

  <script src="bootbox.min.js"></script>
  
</head>


<body data-spy="scroll" data-target=".navbar" data-offset="50" background="images/background.jpg" >
    <!-- Navigation bar code-->
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark fixed-top">  
        <a class="navbar-brand" href="index.html">Tennis Academy</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>      
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="#section1">List Users </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#section2">Find User</a>
            </li>           
            <li class="nav-item">
                    <a class="nav-link" href="#section3">Create Timetable</a>
            </li>  
            <li class="nav-item">
                <a class="nav-link" href="#section4">Update Rounds</a>
            </li>     
            <li class="nav-item">
              <a class="nav-link" href="#section5">Add User </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#section6">Create New Tournament </a>
            </li>
            <span style="float:right;"> <button class='btn btn-outline-primary' onClick='logout()'> Logout </button></span>


          </ul>
        </div>    
      </nav>
      <script>
      function logout(){
        window.location.replace("http://127.0.0.1:3000/index.html")
        }
      </script>



      <div id="section1">
        <br>
        <br>
        <br>
        <br>
        <div class="container">
            <div class="card bg-light text-dark">
              <div class="card-body">
                <h1>List User</h1>
                <button  type="button" class="btn btn-info" id="Button2">Click Me</button>
                <div id="showDIV">
                <table class="flexme" id="table" border="1">
                    <thead>
                      <tr>
                        <th width="100">Username</th>
                        <th width="100">Forename</th>
                        <th width="100">Surname</th>
                        <th width="100">Age</th>
                        <th width="140">Email</th>
                        <th width="100">Instructor</th>
                        <th width="100">Level</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr id="test">
                        <td></td>
                      </tr>
                    </tbody>
                </table>
              </div>
            </div>
          </div>
      </div>
      <script>
            $(document).ready(function () {
            $('#showDIV').hide()
            $('#Button2').click(function () {
                $("#showDIV").fadeToggle('fast');
            });
            });
        $.getJSON( "http://127.0.0.1:3000/people", function( data ) {
        var table = $("#table tbody");
        $.each( JSON.parse(data), function( key, val ) {
          if(val.username !="admin"){
            table.append("<tr><td>" + val.username + "</td><td>"
            + val.forename + "</td><td>" 
            + val.surname + "</td><td>"
            + val.age + "</td><td>" 
            + val.email + "</td><td>" 
            + val.instructor + "</td><td>" 
            + val.level + "</td></td>" );
          }
  })});
          
      </script>
 

      
    <div id="section2" >  
        <br>
        <br>
        <br>
        <br>
        <div class="container">
                <div class="card bg-light text-dark">
                  <div class="card-body">
                    <h1>Find User</h1>
                    <form id="usernameform">
                      <div> Username: <input id="username"> </input> </div>
                      <button  class="btn btn-outline-success" id="getUser">Click Me to Submit</button>                      
                  </form>
                  <button class="btn btn-outline-primary" id="ButtonHide">Click Me to Show/Hide</button>
                  <form>
                  <div id="showDIV1">
                  <table class="flexme" id="table1" border="1">
                      <thead>
                        <tr>
                          <th width="100">Username</th>
                          <th width="100">Forename</th>
                          <th width="100">Surname</th>
                          <th width="100">Age</th>
                          <th width="140">Email</th>
                          <th width="100">Instructor</th>
                          <th width="100">Level</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr id="test1">
                          <td></td>
                        </tr>
                      </tbody>
                      </table>
                    </div></form>
              </div>
                  <script>
                    $(document).ready(function () {
            $('#showDIV1').hide()
            $('#ButtonHide').click(function () {
                $("#showDIV1").fadeToggle('fast');
            });
            });
                          function formhandler(){
                              var username = $("#username").val();
                              $.get("http://127.0.0.1:3000/people/"  +username, 
                                  function (data){
                                    var table1 = $("#table1 tbody");
                                    table1.append("<tr><td>" + data.username + "</td><td>"
                                          + data.forename + "</td><td>" 
                                          + data.surname + "</td><td>"
                                          + data.age + "</td><td>" 
                                          + data.email + "</td><td>" 
                                          + data.instructor + "</td><td>" 
                                          + data.level + "</td></td>" );            
                                            });
                              return false;
                          };
                          $('#usernameform').on('submit', formhandler);
                      
                      </script>
                </div>
                </div>
           
    </div>
    <div id="section3">
        <br>
        <br>
        <br>
        <br>
        <div class="container">
            <div class="card bg-light text-dark">
              <div class="card-body">
                <h1>Create Timetable</h1>
                <p> Here when the users or admin wants to add additional matches then the admin has to press the show users button. Then the admin should select the two users that he/she wants to organize another match and then select the date and then press submit</p>

               
                <button   class="btn btn-outline-info" id="showAllUsers" >Show Users</button>
                
                <form id="against">
                  <div id="res"></div>
                  <span>Usernames: <input readonly="readonly" required="" oninvalid="this.setCustomValidity('Please Enter a username')" oninput="setCustomValidity('')" type="text" id="player1"> </span>
                  <span> VS</span>
                  <span> <input readonly="readonly" required="" oninvalid="this.setCustomValidity('Please Enter a username')" oninput="setCustomValidity('')" type="text" id="player2"></span>
                  <p>Date: <input required="" oninvalid="this.setCustomValidity('Please Enter a date')" oninput="setCustomValidity('')"  type="text1" id="date" /></p>
                  <button class="btn btn-outline-dark" > Submit </button>
                </form>  
                <script>
                    $.getJSON( "http://127.0.0.1:3000/people", function( data ) {
                      $(function(){
                        $('#showAllUsers').click(function(){
                          $('#showAllUsers').prop('disabled', true);
                          var click1=100;
                          $.each(JSON.parse(data), function(index, element) {                        
                            var uname = element.username;
                            if (uname!="admin"){
                              var r= $('<input  type="button" class="btn btn-outline-primary" value='+uname +'>' ).click(function () {              
                              if (click1 % 2==0){
                                document.getElementById("player1").value = uname;
                                click1=click1-1;                                
                              }else{
                                document.getElementById("player2").value = uname;
                                click1=click1-1;  
                              }           
                            });
                            }                         
                         
                            
                          $("#res").append(r);
                          });
                        });
                      });
                    });
                  
                  </script>
  
  
                
        <table border=5 cellspacing=20 cellpadding=20>
            <tr>
            <td colspan="7" align="center"><I>Match Timetable</I></td>
            </tr>
            
            <tr>	
            <td align=center>Mon</td>
            <td align=center>Tue</td>
            <td align=center>Wed</td>
            <td align=center>Thu</td>
            <td align=center>Fri</td>
            <td align=center>Sat</td>
            <td align=center>Sun</td>
            </tr>
            
            <tr>
            <td class="grayedout" align=center></td>
            <td class="grayedout" align=center></td>
            <td class="grayedout" align=center></td>
            <td class="grayedout" align=center></td>
            <td class="grayedout" align=center></td>
            <td class="grayedout" align=center></td>
            <td  data-href="#" id="1" align=center>1</td>
            </tr>
            
            <tr>
            <td  data-href="#" id="2" align=center>2</td>
            <td  data-href="#" id="3" align=center>3</td>
            <td  data-href="#" id="4" align=center>4</td>
            <td  data-href="#" id="5" align=center>5</td>
            <td  data-href="#" id="6" align=center>6</td>
            <td  data-href="#" id="7" align=center>7</td>
            <td  data-href="#" id="8" align=center>8</td>
            </tr>
            
            <tr>
            <td  data-href="#" id="9" align=center>9</td>
            <td  data-href="#" id="10" align=center>10</td>
            <td  data-href="#" id="11" align=center>11</td>
            <td  data-href="#" id="12" align=center>12</td>
            <td  data-href="#" id="13" align=center>13</td>
            <td  data-href="#" id="14" align=center>14</td>
            <td  data-href="#" id="15" align=center>15</td>
            </tr>
            
            <tr>
            <td data-href="#" id="16" align=center>16</td>
            <td data-href="#" id="17" align=center>17</td>
            <td data-href="#" id="18" align=center>18</td>
            <td data-href="#" id="19" align=center>19</td>
            <td data-href="#" id="20" align=center>20</td>
            <td data-href="#" id="21" align=center>21</td>
            <td data-href="#" id="22" align=center>22</td>
            </tr>
            
            <tr>
            <td data-href="#" id="23" align=center>23</td>
            <td data-href="#" id="24" align=center>24</td>
            <td data-href="#" id="25" align=center>25</td>
            <td data-href="#" id="26" align=center>26</td>
            <td data-href="#" id="27" align=center>27</td>
            <td data-href="#" id="28" align=center>28</td>
            <td data-href="#" id="29" align=center>29</td>
            </tr>
            
            <tr>
            <td data-href="#" id="30" align=center>30</td>
            <td data-href="#" id="31" align=center>31</td>
            <td class="grayedout" align=center></td>
            <td class="grayedout" align=center></td>
            <td class="grayedout" align=center></td>
            <td class="grayedout" align=center></td>
            <td class="grayedout" align=center></td>
            
            </tr>
            
            </table> 
            <form id=randomMatches>
                
               <!-- <input id="round" /> --> 
               <br>
                <button class="btn btn-outline-success" id="sendRound"> Proceed to Next Round</button>

              </form>

            </div>
            </div>
            </div>
            <script> 
            $.getJSON( "http://127.0.0.1:3000/people", function( data ) {
                      
                      var x = JSON.parse(data);
                      for (var i = 0; i < x.length; i++){               
                          if (x[i].username != "admin"){
                            console.log(x[i].username);
                            if (x[i].date1==""){
                              return;
                            }
                           /* if (x[i].date != ""){
                              var date= x[i].date;
                              var game = x[i].username + " VS " + x[i].opponent;
                              document.getElementById(date).innerHTML =date +  "<br>" + game;
                            }*/
                            var date1=x[i].date1;                            
                            var date2=x[i].date2;
                            var date3=x[i].date3;
                            var date4=x[i].date4;
                            var game1=x[i].username + " VS " + x[i].opponent1;
                            document.getElementById(date1).innerHTML = date1 + "<br>" + "round[" + x[i].round + "]" + " " +  "<br>" + game1;
                            if(date2 != ""){
                              var game2= x[i].username + " VS " + x[i].opponent2; 
                              document.getElementById(date2).innerHTML =date2 + "<br>" + "round[" + x[i].round + "]" + " " +  "<br>" + game2;
                            if (date3!="") {                              
                              var game3= x[i].username + " VS " + x[i].opponent3;               
                              
                              document.getElementById(date3).innerHTML =date3 + "<br>" + "round[" + x[i].round + "]" + " " +  "<br>" + game3;
                             
                            }
                          }
                          }
                      }
                       
                  
                   });
            
            if (localStorage.getItem("countMatches") == null){
              var countMatches = 0;
              var round = 0;
              round = parseInt(round);
            }else {
            var countMatches = localStorage.getItem("countMatches");
            var round = localStorage.getItem("round");
            countMatches= parseInt(countMatches);
            round = parseInt(round);
            }
            
                   console.log("storage Matches" + countMatches);
                   console.log("storage Round " + round);
              function formhandler4(){
                if((round == 0) || (round == 1 && countMatches == 4) || (round == 2 && countMatches == 2) || (round == 3 && countMatches == 1)){
                  alert("Round over");
                }else {
                  alert("Round not over");
                  localStorage.setItem("countMatches", countMatches);
                  localStorage.setItem("round", round);
                  return;
                }
                 
                
                  var date_array = [];
                  
                  console.log("round: " + round);
                  console.log("Matches:  " + countMatches);
                  $.get("http://127.0.0.1:3000/createTournament" , "round=" + round, 
                  
                      function (data){
                        console.log(data);
                        round+=1;
                        
                        countMatches=0;
                        for (var i=0 ; i < data.length ; i++){
                          var datePlaying= data[i].value;
                          var players = data[i].key
                            console.log(players + " on " + datePlaying);
                            document.getElementById(datePlaying).innerHTML=datePlaying + '<br>' + players;                              
                        }
                      });
                      
                  return false;
                  
              };
             
              $('#randomMatches').on('submit', formhandler4);
           
       

            let row = $('tr');
                row.each((index,row) =>{
                  if(index !== 0) return; // We only want 1 entry of!
              
                  $('td').each((index,day) => { // For each day
                      if($(day).hasClass('grayedout')) return;
                   $(day).on('click',addApointment); // The part we care about
                  });
              })

              function test(dayNum){
                var string=dayNum;
                var currentRound;
                if (isNaN(string.charAt(7)) === false){
                    currentRound=string.charAt(7);
                } else if (isNaN(string.charAt(8)) === false){
                    currentRound=string.charAt(8);
                }
                dayNum = dayNum.replace('round[', '');
                
               // console.log("curent: " + currentRound);
                if (dayNum.includes(']')){
                  if (isNaN(dayNum.charAt(2))){
                  for (var i =0;i<4;i++)
                  {
                    dayNum = dayNum.substr(1);
                  }
                }
                 else if (!isNaN(dayNum.charAt(1))){
                    //console.log(dayNum);
                for (var i =0;i<5;i++)
                
                  {
                    dayNum = dayNum.substr(1);
                  }
                } 
                } else if (!isNaN(dayNum.charAt(1)))  {
                  for (var i =0;i<2;i++)
                  {
                    dayNum = dayNum.substr(1);
                  }
                }else {
                  for (var i =0;i<1;i++)
                  {
                    dayNum = dayNum.substr(1);
                  }
                }
                dayNum= dayNum.split(' ');                
                console.log(dayNum);
                var pl1=dayNum[0];
                var pl2=dayNum[2];
                bootbox.prompt({
        title: "This is a prompt with a set of checkbox inputs!",
        inputType: 'checkbox',
        inputOptions: [
            {
                text: pl1,
                value: pl1,
            },
            {
                text: pl2,
                value: pl2,
            },
        ],
        callback: function (result) {
           // console.log(result);
            var winnerPlayer1 = result[0];
            var winnerRound1 = currentRound;
           // console.log("winner Player: " + winnerPlayer1);
           // console.log("winning round: " + winnerRound1);
            $.get("http://127.0.0.1:3000/updateRound" , "player=" + winnerPlayer1 + "&" + "round="+winnerRound1, 
                function (data){
               //  console.log(data);
                 alert(data);
                   countMatches+=1;
                   //round +=1;
                });
        }
        
    });
              }
              
              function addApointment() {

                  let dayNum = $(this).text();
                  let appointment = test(dayNum);
               
              }

            function formhandler2(){
            var p1 = $("#player1").val();
            var p2 = $("#player2").val();
            if (p1===p2){
              alert("Same user is selceted.Please select another user");  
              window.location.href='#section3';  
              document.getElementById(date).innerHTML =date;        
            }
            var date = $("#date").val();
            let appointment = p1 + " VS " + p2;
            document.getElementById(date).innerHTML =date +  "<br>" + appointment;
            $.get("http://127.0.0.1:3000/against" , "player1=" + p1 + "&" + "player2="+p2+ "&"+ "date="+date, 
                function (data){
                 
                   
                });
            return false;
        };
        $('#against').on('submit', formhandler2);
                               
                </script>

    </div>
    <div id="section4" >  
        <br>
        <br>
        <br>
        <br>
        <div class="container">
            <div class="card bg-light text-dark">
              <div class="card-body">
                <h1>Update Rounds</h1>
                <button class="btn btn-outline-info" id="showUsersRounds">Show users</button>
                <div id="resRound"></div>
                <form id="rounds">
                   
                    <label>Winning Player </label><input readonly="readonly" required="" oninvalid="this.setCustomValidity('Please Select a username')" oninput="setCustomValidity('')" type="text" id="winnerPlayer" />
                    <label>Round Won </label><input id="winnerRound" />
                    <button id="roundSubmit">Submit </button>
                    <div id="resUpdateRound"></div>
                </form>
              </div>
              <script>
                $.getJSON( "http://127.0.0.1:3000/people", function( data ) {
                      $(function(){
                        $('#showUsersRounds').click(function(){
                          $('#showUsersRounds').prop('disabled', true);
                          
                          $.each(JSON.parse(data), function(index, element2) {                        
                            var uname1 = element2.username;
                            if (uname1!="admin"){
                              var r1= $('<input  type="button" class="btn btn-outline-primary" value='+uname1 +'>' ).click(function () {              
                                document.getElementById("winnerPlayer").value = uname1;               
                            });
                          }                     
                          $("#resRound").append(r1);
                        
                        });
                      });
                    });
                  });
                  $( "#roundSubmit" ).click(function() {
                    function formhandler6(){
            var winnerPlayer1 = $("#winnerPlayer").val();
            var winnerRound1 = $("#winnerRound").val();
            console.log(winnerPlayer1);
            console.log(winnerRound1);
            $.get("http://127.0.0.1:3000/updateRound" , "player=" + winnerPlayer1 + "&" + "round="+winnerRound1, 
                function (data){
                 console.log(data);
                 $( "#resUpdateRound" ).html(data);
                   
                });
            return false;
        };
        $('#rounds').on('submit', formhandler6());

                  });
                
                               
              
              
              </script>
            </div>
          </div>

    </div>
    <div id="section5" >  
        <br>
        <br>
        <br>
        <br>
        <div class="container">
            <div class="card bg-light text-dark">
              <div class="card-body">
                <h1>Add User</h1>
                <form id="usernameform1">
                    <div class="form-row">
                        <div class="form-group col-md-6">
                          <label for="inputEmail4">Forename</label>
                          <input type="text" class="form-control" id="forename" placeholder="Forename">
                        </div>
                        <div class="form-group col-md-6">
                          <label for="inputPassword4">Surname</label>
                          <input type="text" class="form-control" id="surname" placeholder="Surname">
                      </div>
                    </div>
                    <div class="form-group">
                        <label for="inputAddress">Username</label>
                        <input type="text" class="form-control" id="username1" placeholder="Username">
                    </div>
                    <div class="form-group">
                        <label for="inputAddress2">Email</label>
                        <input type="email" class="form-control" id="email" placeholder="test@test.com">
                      </div>
                      <div class="form-row">
                          <div class="form-group col-md-5">
                            <label for="inputCity">Age</label>
                            <input type="text" class="form-control" id="age">
                          </div>
                          <div class="form-group col-md-4">
                            <label for="inputState">Instructor</label>
                            <select id="instructor" class="form-control">
                              <option selected>Choose your instructor</option>
                              <option  data-toggle="tooltip" data-placement="right" title="Suitable for adults">Logan Taylor</option>
                              <option  data-toggle="tooltip" data-placement="right" title="Suitable for children age less than 15">Mason Bates</option>
                              <option  data-toggle="tooltip" data-placement="right" title="Sutiable for adults">Andrew Winter</option>
                            </select>
                          </div>
                          <div class="form-group col-md-3">
                              <label for="inputState">Level</label>
                              <select id="level" class="form-control">
                                <option selected>Choose your level</option>
                                <option>Beginner</option>
                                <option>Intermediate</option>
                                <option>Advnaced</option>
                              </select>
                          </div>
                        </div>
                        <button id="submitButton" type="submit" class="btn btn-primary">Sign in</button>

                <!--   <div> Username: <input id="username1"> </input> </div>
                  <div> Firstname: <input id="forename"> </input> </div>
                  <div> Lastname: <input id="surname"> </input> </div>
                  <div> age: <input id="age"> </input> </div>
                  <div> email: <input id="email"> </input> </div>
                  <button id="submit">Click Me to Submit</button>   -->                   
          
              </form>
          
              <div id ="usernameresult1"></div>

              <script>
                
               
                  function formhandler1(){

                    
                      $.post("http://127.0.0.1:3000/people" ,{
                          access_token : "concertina",
                          username : $("#username1").val(),
                          forename : $("#forename").val(),
                          surname : $("#surname").val(),
                          age : $("#age").val(),
                          email : $("#email").val(),
                          instructor :  $("#instructor").val(),  
                          level : $("#level").val(),   
                          opponent1 : "",
                          opponent2 : "",
                          opponent3 : "",    
                          date1 : "",    
                          date2 : "",
                          date3 : "", 
                          round : ""  
                      } ,
                          function (data){                            
                              $('#usernameresult1').html(data);
                          }).fail(
                            function(rec, textStatus, errorThrown) {
                              console.log(rec.responseText);  
                              $('#usernameresult1').html(rec.responseText);                                
                            }
                          );
                          
                      return false;
                  };
                  $('#usernameform1').on('submit', formhandler1);
              
              </script>
    </div>
    </div>
    <div id="section6">
      <br>
      <br>
      <br>
      <br>
      <div class="container">
          <div class="card bg-light text-dark">
            <div class="card-body">
              <h1>Create New Tournament</h1>
              <button  type="button"  class="btn btn-outline-info" id="winnerButton">Get winner</button>
              <button  type="button"  class="btn btn-outline-danger" id="newTourButton">Create new Tournament</button>

            </div>
            
          </div>
        </div>
        <script>
           $(document).ready(function () {            
            $('#winnerButton').click(function () {
              var counterRound3 =0;
              var counterRound4 =0;
              var winner;
                  $.getJSON( "http://127.0.0.1:3000/people", function( data ) {
                  $.each( JSON.parse(data), function( key, val ) {
                    if (val.round==3){
                      //alert("The winner is: " + val.username);
                      winner=val.username;
                      counterRound3 +=1;
                    } 
                    if (val.round==4){
                      //alert("The winner is: " + val.username);
                      winner=val.username;
                      counterRound4 +=1;
                    } 
                    });
                    if (counterRound3 == 1){
                      alert("The winner is: " + winner);
                    }
                    if (counterRound4 == 1){
                      alert("The winner is: " + winner);
                    }
                   //alert("Tournament currently in progress");
                  });
              });
              });

              $(document).ready(function () {            
            $('#newTourButton').click(function () {
                  $.getJSON( "http://127.0.0.1:3000/newTournament", function( data ) {
                    
                  });
                  localStorage.setItem("countMatches", 0);
                  localStorage.setItem("round", 0);
                  alert("New tournament has been created");
              });
              });

          
      
        </script>
    </body>

    </html>